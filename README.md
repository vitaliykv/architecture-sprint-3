
Задание 1. Анализ и планирование
 
 Определите домены и границы контекстов. 
  Домен: Управление отоплением
   поддомен: управления устройствами отопления
   поддомен: взаимодействие с датчиками температуры

  граница поддомена совпадает с границей контекста.
   
 Подробно опишите существующие проблемы монолитного решения в контексте бизнес-задач компании. 
   Сложно масштабировать монолит под увеличение нагрузки.
   Необходимо значительное расширение функционала, а значит проявятся проблемы монолита: высокий риск ошибок, длительные циклы разработки и развёртывания, трудности управления командой (конфликты, задержки, влияние на работу других команд)

 Визуализируйте контекст системы. Создайте диаграмму контекста (Context diagram) в модели C4 с помощью PlantUML. 
   diagrams/3_1_Component.puml


Задание 2. Проектирование микросервисной архитектуры
  diagrams/3_2_Containers.puml
  diagrams/3_2_Components.puml
  diagrams/3_2_Code.puml
 
 Декомпозируйте приложение на микросервисы
   UserSrv - сервис управления пользователями (управление информацией о пользователях их ролях, регистрацией, аутентификацией и авторизацией)
   HouseSrv - сервис управления домами (новое подключение к дому, редактирование, удаление)
   HeatingSrv - сервис управления устройствами отопления (включать/выключать отопление, устанавливать желаемую температуру)
   TemperatureSensorSrv  - сервис взаимодействие с датчиками температуры (просматривать текущую температуру, сбор телеметрии)
   LightSrv - Управление освещением (включать и выключать свет)
   GatesSrv - Управление воротами (запирать и отпирать автоматические ворота)
   VideoControl - Управление видеокамерами (удалённо наблюдать за домом)

   Пользователь регистрируется, входит.
   Подключает дом (HouseSrv).
   Видит список доступных модулей (сервисов), самомтоятельно выбирает и подключает.
   Управляет.
   Новая функциональность добавляется через создание нового сервиса со своим микрофронтендом.
   

Задание 3. Разработка ER-диаграммы
 
 Идентифицируйте сущности. 
   Пользователь — User,
   Умный дом — SmartHome,
   Устройство отопления — Heating,
   Датчик температуры — TemperatureSensor,
   Устройство освещения — Light,
   Ворота — Gates,
   Видеокамера - VideoControl.

 Определите атрибуты
    
    User
      Id - униккальный идентификатор пользователя
      Name - Имя
      Email - почта

    SmartHome
      Id - униккальный идентификатор дома
      UserId - идентификатор пользователя
      Name - Название
      Address - адрес дома

    Heating
      Id - уникальный идентификатор устройства 
      SmartHomeId - идентификатор дома
      Name - Название
      Status - текущее состояние устройства (включено/выключено)

    TemperatureSensor
      Id - уникальный идентификатор устройства 
      SmartHomeId - идентификатор дома
      Name - Название
      Status - текущее состояние устройства (включено/выключено)

    Light
      Id - уникальный идентификатор устройства 
      SmartHomeId - идентификатор дома
      Name - Название
      Status - текущее состояние устройства (включено/выключено)

    Gates
      Id - уникальный идентификатор устройства 
      SmartHomeId - идентификатор дома
      Name - Название
      Status - текущее состояние устройства (открыто/закрыто)

    VideoControl
      Id - уникальный идентификатор устройства 
      SmartHomeId - идентификатор дома
      Name - Название
      Status - текущее состояние устройства (включено/выключено)


 Опишите связи. Определите связи между сущностями (один-к-одному, один-ко-многим, многие-ко-многим).
   
   User - SmartHome: один пользователь может иметь доступ к нескольким домам, но каждый дом связан только с одним пользователем.

   SmartHome — Heating: один дом может содержать несколько устройств, и каждое устройство принадлежит только одному дому.

   SmartHome — TemperatureSensor: один дом может содержать несколько устройств, и каждое устройство принадлежит только одному дому.
   
   SmartHome — Heating: один дом может содержать несколько устройств, и каждое устройство принадлежит только одному дому.
   
   SmartHome — Light: один дом может содержать несколько устройств, и каждое устройство принадлежит только одному дому.
   
   SmartHome — Gates: один дом может содержать несколько устройств, и каждое устройство принадлежит только одному дому.
   
   SmartHome — Video: один дом может содержать несколько устройств, и каждое устройство принадлежит только одному дому.


  Постройте ER-диаграмму. 
    iagrams/3_3_ER.puml





















# Базовая настройка

## Запуск minikube

[Инструкция по установке](https://minikube.sigs.k8s.io/docs/start/)

```bash
minikube start
```

## Добавление токена авторизации GitHub

[Получение токена](https://github.com/settings/tokens/new)

```bash
kubectl create secret docker-registry ghcr --docker-server=https://ghcr.io --docker-username=<github_username> --docker-password=<github_token> -n default
```

## Установка API GW kusk

[Install Kusk CLI](https://docs.kusk.io/getting-started/install-kusk-cli)

```bash
kusk cluster install
```

## Смена адреса образа в helm chart

После того как вы сделали форк репозитория и у вас в репозитории отработал GitHub Action. Вам нужно получить адрес образа <https://github.com/><github_username>/architecture-sprint-3/pkgs/container/architecture-sprint-3

Он выглядит таким образом
```ghcr.io/<github_username>/architecture-sprint-3:latest```

Замените адрес образа в файле `helm/smart-home-monolith/values.yaml` на полученный файл:

```yaml
image:
  repository: ghcr.io/<github_username>/architecture-sprint-3
  tag: latest
```

## Настройка terraform

[Установите Terraform](https://yandex.cloud/ru/docs/tutorials/infrastructure-management/terraform-quickstart#install-terraform)

Создайте файл ~/.terraformrc

```hcl
provider_installation {
  network_mirror {
    url = "https://terraform-mirror.yandexcloud.net/"
    include = ["registry.terraform.io/*/*"]
  }
  direct {
    exclude = ["registry.terraform.io/*/*"]
  }
}
```

## Применяем terraform конфигурацию

```bash
cd terraform
terraform init
terraform apply
```

## Настройка API GW

```bash
kusk deploy -i api.yaml
```

## Проверяем работоспособность

```bash
kubectl port-forward svc/kusk-gateway-envoy-fleet -n kusk-system 8080:80
curl localhost:8080/hello
```

## Delete minikube

```bash
minikube delete
```
